<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=1024, height=768">
    <title>Arc Scroll Interface</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000000;
            width: 1024px;
            height: 768px;
            overflow: hidden;
            font-family: 'Montserrat', Tahoma, Geneva, Verdana, sans-serif;
            position: relative;
            user-select: none;
        }

        #container {
            width: 1024px;
            height: 768px;
            position: relative;
        }

        .item {
            position: absolute;
            display: flex;
            align-items: center;
            opacity: 0.4;
            transform: scale(0.9);
            will-change: transform, opacity;
        }

        .item.selected {
            opacity: 1;
            transform: scale(1);
            filter: drop-shadow(0 0 20px rgba(255, 255, 255, 0.3));
        }

        .item-name {
            color: #ffffff;
            margin-right: 20px;
            font-size: 14px;
            text-align: right;
            white-space: nowrap;
            opacity: 0.7;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);
            transform: none !important; /* Prevent text tilting */
        }

        .item.selected .item-name {
            font-size: 20px;
            font-weight: 600;
            opacity: 1;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
        }

        .item-image {
            width: 40px;
            height: 40px;
            border-radius: 12px;
            object-fit: cover;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        .item.selected .item-image {
            width: 64px;
            height: 64px;
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.7);
        }

        .pos-1 { 
            right: 60px; 
            top: 60px;
            transform: scale(0.8);
        }
        .pos-2 { 
            right: 110px; 
            top: 165px;
            transform: scale(0.8);
        }
        .pos-3 { 
            right: 135px; 
            top: 275px;
            transform: scale(0.8);
        }
        .pos-4 { 
            right: 145px; 
            top: 384px;
            transform: scale(1);
        }
        .pos-5 { 
            right: 135px; 
            top: 493px;
            transform: scale(0.8);
        }
        .pos-6 { 
            right: 110px; 
            top: 603px;
            transform: scale(0.8);
        }
        .pos-7 { 
            right: 60px; 
            top: 708px;
            transform: scale(0.8);
        }

        /* Debug info */
        #debug {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #666;
            font-size: 12px;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div id="arc-guide"></div>
    <div id="container"></div>
    <div id="debug"></div>
    <div id="scroll-hint">Scroll or use ↑↓ to navigate</div>

    <script>
        // Generate dummy data with more interesting names
        const items = [];
        const categories = [
            'Chill Vibes',
            'Workout Mix',
            'Focus Flow',
            'Party Time',
            'Road Trip',
            'Study Session',
            'Dinner Party',
            'Morning Coffee',
            'Late Night',
            'Weekend Vibes'
        ];
        
        const adjectives = [
            'Ultimate', 'Essential', 'Classic', 'Fresh', 'Vintage',
            'Modern', 'Epic', 'Relaxing', 'Energetic', 'Smooth',
            'Best of', 'Greatest', 'Premium', 'Curated', 'Special'
        ];
        
        for (let i = 1; i <= 100; i++) {
            const category = categories[i % categories.length];
            const adjective = adjectives[i % adjectives.length];
            items.push({
                id: `item-${i}`,
                name: `${adjective} ${category}`,
                image: `https://picsum.photos/seed/${i}/64/64`
            });
        }

        let currentIndex = 0;
        let isScrolling = false;
        const container = document.getElementById('container');
        const debug = document.getElementById('debug');

        function getVisibleItems() {
            const visibleItems = [];
            const totalItems = items.length;
            
            // Calculate the range of items to show
            let startPos = Math.max(0, currentIndex - 3);
            let endPos = Math.min(totalItems - 1, currentIndex + 3);
            
            // Adjust the number of items shown based on position
            if (currentIndex < 3) {
                endPos = Math.min(6, totalItems - 1);
            } else if (currentIndex > totalItems - 4) {
                startPos = Math.max(0, totalItems - 7);
            }
            
            // Create the visible items array
            for (let i = startPos; i <= endPos; i++) {
                const position = i - currentIndex + 4; // Center position is 4
                visibleItems.push({ item: items[i], position });
            }
            
            return visibleItems;
        }

        function render() {
            container.innerHTML = '';
            const visibleItems = getVisibleItems();
            
            visibleItems.forEach(({ item, position }) => {
                const itemEl = document.createElement('div');
                itemEl.className = `item pos-${position}`;
                if (position === 4) {
                    itemEl.classList.add('selected');
                }
                
                const nameEl = document.createElement('div');
                nameEl.className = 'item-name';
                nameEl.textContent = item.name;
                
                const imgEl = document.createElement('img');
                imgEl.className = 'item-image';
                imgEl.src = item.image;
                imgEl.loading = 'lazy';
                
                itemEl.appendChild(nameEl);
                itemEl.appendChild(imgEl);
                container.appendChild(itemEl);
            });
            
            debug.innerHTML = `Selected: <strong>${items[currentIndex].name}</strong> | Index: ${currentIndex + 1}/100`;
        }

        function scroll(direction) {
            if (isScrolling) return;
            
            isScrolling = true;
            const oldIndex = currentIndex;
            
            // Prevent scrolling beyond boundaries
            if (direction > 0 && currentIndex < items.length - 1) {
                currentIndex++;
            } else if (direction < 0 && currentIndex > 0) {
                currentIndex--;
            }
            
            // Only render if the index actually changed
            if (oldIndex !== currentIndex) {
                requestAnimationFrame(render);
            }
            
            setTimeout(() => {
                isScrolling = false;
            }, 50);
        }

        // Keyboard support
        window.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                scroll(-1);
            } else if (e.key === 'ArrowDown') {
                e.preventDefault();
                scroll(1);
            }
        });

        render();

        // Hide scroll hint after first interaction
        let interacted = false;
        ['keydown'].forEach(event => {
            window.addEventListener(event, () => {
                if (!interacted) {
                    interacted = true;
                    document.getElementById('scroll-hint').style.display = 'none';
                }
            }, { once: true });
        });
    </script>
     <script>
        // WebSocket connection for navigation wheel events
        let ws = null;
        let lastClickTime = 0;
        const CLICK_THROTTLE_MS = 27; // Max 5 times per second (1000ms / 5 = 200ms)
        
        function connectWebSocket() {
            try {
                ws = new WebSocket('ws://localhost:8765');
                
                ws.onopen = () => {
                    console.log('WebSocket connected');
                };
                
                ws.onmessage = (event) => {
                    try {
                        const data = JSON.parse(event.data);
                        handleWebSocketMessage(data);
                    } catch (error) {
                        console.error('Error parsing WebSocket message:', error);
                    }
                };
                
                ws.onclose = () => {
                    console.log('WebSocket disconnected');
                    // Attempt to reconnect after 2 seconds
                    setTimeout(() => connectWebSocket(), 2000);
                };
                
                ws.onerror = (error) => {
                    console.error('WebSocket error:', error);
                };
            } catch (error) {
                console.error('Error creating WebSocket:', error);
            }
        }
        
        function handleWebSocketMessage(data) {
            // Log all received WebSocket messages
            console.log('Received WebSocket message:', data);
            
            // Listen for navigation wheel events (not volume or laser)
            if (data.type === 'nav' && data.data) {
                const direction = data.data.direction; // 'clock' or 'counter'
                
                // Find the scrollable container
                const container = document.getElementById('container');
                if (!container) return;
                
                // Check boundaries before scrolling or clicking
                const atTop = currentIndex === 0;
                const atBottom = currentIndex === items.length - 1;
                const scrollingUp = direction === 'counter';
                const scrollingDown = direction === 'clock';
                
                // Don't scroll or click if at boundaries
                if ((atTop && scrollingUp) || (atBottom && scrollingDown)) {
                    console.log('At boundary - not scrolling or clicking');
                    return;
                }
                
                // Scroll the container content
                if (scrollingDown) {
                    // Scroll down
                    scroll(1);
                } else if (scrollingUp) {
                    // Scroll up
                    scroll(-1);
                }
                
                // Send click command back to server (rate limited)
                sendClickCommand();
            }
        }
        
        function sendClickCommand() {
            if (!ws || ws.readyState !== WebSocket.OPEN) return;
            
            const now = Date.now();
            
            // Rate limiting: only send if at least 200ms have passed since last send
            if (now - lastClickTime < CLICK_THROTTLE_MS) {
                console.log('Click command throttled - too soon');
                return;
            }
            
            lastClickTime = now;
            
            const message = {
                type: 'command',
                command: 'click',
                params: {}
            };
            
            ws.send(JSON.stringify(message));
            console.log('Sent click command to server');
        }
        
        // Initialize WebSocket connection when page loads
        document.addEventListener('DOMContentLoaded', () => {
            connectWebSocket();
        });
    </script>
</body>
</html>