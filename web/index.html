<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>BeoSound 5 Dashboard</n></title>
  <style>
    /* Fixed viewport */
    html, body { margin:0; padding:0; width:1024px; height:768px; overflow:hidden; }
    #main-ui {
      position: relative;
      width: 1024px;
      height: 768px;
      border: 8px solid red;
      background: black;
    }
    /* Controls and artwork fill the area */
    #controls { position:absolute; left:0; top:0; width:150px; height:100%; background:#1c1c1c; }
    #controls button { display:block; width: 120px; margin: 10px auto; font-size:1em; }
    #slider-vol, #slider-laser {
      width:120px; margin:10px auto; display:block;
    }
    #artwork-container {
      position:absolute; left:150px; top:0; right:0; bottom:0; overflow:hidden;
    }
    #artwork { position:absolute; max-width:100%; max-height:100%; left:50%; top:50%; transform:translate(-50%,-50%); }
    #info-box {
      position:absolute; bottom:20px; left:50%; transform:translateX(-50%);
      background:rgba(0,0,0,0.7); color:white; padding:8px 16px; border-radius:8px; text-align:center;
    }
    #laser-pointer { position:absolute; left:150px; width:4px; height:24px; background:cyan; }
    /* WebSocket log */
    #ws-log {
      position:absolute; top:0; right:0; background:red; color:white;
      font-family:monospace; font-size:0.8em; padding:4px; width:300px; height:60px; overflow:hidden;
    }
  </style>
</head>
<body>
  <div id="main-ui">
    <div id="controls">
      <button id="btn-prev">Prev</button>
      <button id="btn-next">Next</button>
      <input type="range" id="slider-vol" min="0" max="100" />
      <input type="range" id="slider-laser" min="0" max="100" />
    </div>
    <div id="artwork-container">
      <img id="artwork" src="" alt="Art" />
      <div id="info-box">
        <div id="track-title">—</div>
        <div id="track-album">—</div>
        <div id="track-artist">—</div>
      </div>
      <div id="laser-pointer"></div>
      <div id="ws-log"></div>
    </div>
  </div>

  <script>
    const WS_URL = "ws://localhost:8765";
    const ws = new WebSocket(WS_URL);

    // Elements
    const btnPrev = document.getElementById('btn-prev');
    const btnNext = document.getElementById('btn-next');
    const sliderVol   = document.getElementById('slider-vol');
    const sliderLaser = document.getElementById('slider-laser');
    const artworkEl   = document.getElementById('artwork');
    const titleEl     = document.getElementById('track-title');
    const albumEl     = document.getElementById('track-album');
    const artistEl    = document.getElementById('track-artist');
    const laserPtr    = document.getElementById('laser-pointer');
    const wsLog       = document.getElementById('ws-log');

    // WS message queue
    const recent = [];
    function logMsg(msg) {
      recent.unshift(msg);
      if (recent.length>3) recent.pop();
      wsLog.innerText = recent.join('\n');
    }

    ws.onopen = () => logMsg('WS open');
    ws.onclose = () => logMsg('WS close');
    ws.onerror = e => logMsg('WS error');

    ws.onmessage = ev => {
      const {type,data} = JSON.parse(ev.data);
      logMsg(`${type}: ${JSON.stringify(data)}`);

      switch(type) {
        case 'button':
          if (data.button==='left')  btnPrev.click();
          if (data.button==='right') btnNext.click();
          break;
        case 'volume':
          sliderVol.value = data.speed;
          sliderVol.dispatchEvent(new Event('input'));
          break;
        case 'laser':
          const pct = data.position;
          sliderLaser.value = pct;
          sliderLaser.dispatchEvent(new Event('input'));
          // position pointer
          const cont = document.getElementById('artwork-container').getBoundingClientRect();
          const x = cont.left + pct/100 * cont.width;
          laserPtr.style.top = (cont.top+10)+'px';
          laserPtr.style.left = x+'px';
          break;
      }
    };

    // Stub handlers (replace with HA fetch logic or callbacks)
    btnPrev.addEventListener('click', () => console.log('Prev song'));
    btnNext.addEventListener('click', () => console.log('Next song'));
    sliderVol.addEventListener('input', () => console.log('Set vol', sliderVol.value));
    sliderLaser.addEventListener('input', () => console.log('Laser pos', sliderLaser.value));
  </script>
</body>
</html>
